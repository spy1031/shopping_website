<div class="container">
  <div class="row">
    <div class="col-md-9">
      <% @products.each do |product|%>
        <div class="col-md-1" style="width:20%" id="<%= product.id%>">
          <div class="product-item clearfix">
            <%=image_tag product.image %>
            <div class="item-text">
              <h5><%= product.name %></h5>
              <div class="product-description">
                <%= truncate(product.description, length: 40 )%>
              </div>
              
              <h6>$<%= product.price %></h6>
              <button id="add_to_cart" class="btn btn-success">add to Cart</button>
            
            </div>
              
          </div>
        </div>  
      <% end %>
    </div>
    <div class="col-md-3"">
      <h3>Cart</h3>
      <hr>
      <% if @cart_items != nil %>
        <div id="cart-list">
          <% @cart_items.each do |item|%>
            <div id="<%= item.product.id%>">
              <div class="product-item clearfix" >
                <div class="product-image col-md-6">
                  <img src="<%= item.product.image%>">
                </div>
                <div class="col-md-6">
                  <h5><%= item.product.name %></h5>                  
                  <div class="col-md-6" id="product_q">
                    <h6><%= item.quantity %></h6>
                  </div>
                  <div class="col-md-6" >
                    
                  </div>                           
                </div>                
              </div>
            </div>              
          <% end %>
        </div>          
      <% end %>
    </div>
      
  </div>
  <div class="text-center">
     <%= paginate @products %>
  </div>
 
</div>

<script type="text/javascript">
  $(".product-item").on("click", "#add_to_cart", function(event){
    var id  = event.target.parentNode.parentNode.parentNode.id;

    $.ajax({
      url: "/products/add_to_cart/?id=" + id,
      method: "POST",
      dataType: "json",      
      success: function(data){

        var cart_item = $("#cart-list").find("#"+data["id"]);
        if(cart_item.length){
          console.log(data["quantity"]);
          $(cart_item).find("h6").html(data["quantity"]);
        }
        else
        {
          cart_item = document.createElement("div");
        

          var photo = data["image"];
          cart_item.id= data["id"];
          $(cart_item).html($("#cart-product-template").html());        
          
          var p_img = $(cart_item).find(".product-image");
          p_img.append('<img>');
          p_img.find("img").attr("src",photo);
          $(cart_item).find("h5").html(data["name"]);
          
          $(cart_item).find("h6").html(data["quantity"]);
          $("#cart-list").append(cart_item);
        }
      }
    })    
  }); 

</script>

<script type="text/template" id="cart-product-template">
  <div class="product-item clearfix" >
    <div class="product-image col-md-6">
    
    </div>
    <div class="col-md-6">
      <h5></h5>      
      <div class="col-md-6" id="product_q">
        <h6></h6>
      </div>  
      <div class="col-md-6" >                    
      </div>                               
    </div>                
  </div>
</script>